# Card Features Update - Implementation Summary

This document describes the new features added to task cards in the Itracksy project management system.

## Features Implemented

### 1. Deadline Display with Countdown

Cards now display due dates with automatic countdown calculation:
- **Display Format**: "Due: Oct 10 (in 8 days)"
- **Overdue Format**: "Due: Oct 10 (overdue by 2 days)"
- **Today Format**: "Due: Oct 10 (today)"
- **Color Coding**:
  - Red: Overdue
  - Orange: Due today
  - Yellow: Due within 3 days
  - Default: More than 3 days away

**Location**: Card component displays the deadline below the description with a calendar icon.

### 2. Estimated Time & Focus Session Integration

Cards support estimated time tracking:
- **Input Format**: Hours and minutes (e.g., 2h 30m)
- **Focus Session Integration**: When starting a focus session from a card, the timer automatically uses the card's estimated time instead of the default duration
- **Display**: Shows estimated time on the card with a clock icon

**Benefits**:
- Better time planning per task
- Automatic timer setup based on planned effort
- Easy tracking of actual vs estimated time

### 3. Subtasks / Checklist

Cards now support subtasks for breaking down work:
- **Add Subtasks**: Click on a card to open the detail dialog, then add subtasks
- **Mark Complete**: Check off subtasks as they're completed
- **Progress Display**: Card shows overall progress (e.g., "20% - 2/10 completed")
- **Visual Indicator**: Checklist icon with completion percentage

**Features**:
- Add/remove subtasks
- Toggle completion status
- Persistent storage with task
- Real-time progress calculation

### 4. Column-Level Metrics

Each column now displays aggregate metrics at the top:
- **Card Count**: Total number of cards in the column
- **Estimated Hours**: Sum of all estimated time for cards in that column (e.g., "Est: 10.5h")

**Format**: "6 cards | Est: 10.5h"

## Technical Implementation

### Database Schema Changes

Added three new fields to the `items` table:
- `due_date` (integer): Unix timestamp for deadline
- `estimated_minutes` (integer): Estimated time in minutes
- `subtasks` (text): JSON array of subtask objects

### Migration

Migration file: `drizzle/0016_supreme_jackpot.sql` (auto-generated by drizzle-kit)

The migration will be automatically applied on next app startup.

**How it was created**:
```bash
npm run db:generate
```

This command analyzed the schema changes and automatically generated the proper migration SQL.

### New Utility Functions

Created `src/utils/dateUtils.ts` with helper functions:
- `formatDate()`: Format timestamps for display
- `calculateDaysRemaining()`: Calculate days until deadline
- `formatDeadlineWithCountdown()`: Format deadline with countdown text
- `getDeadlineColorClass()`: Get Tailwind CSS color class based on urgency
- `formatEstimatedTime()`: Format minutes into human-readable format

### Component Updates

**Card Component** (`src/pages/projects/components/Card.tsx`):
- Added deadline display with countdown
- Added estimated time display
- Added subtask progress indicator
- Modified focus session start to use estimated time

**Column Component** (`src/pages/projects/components/Column.tsx`):
- Added column metrics calculation
- Display card count and total estimated hours

**ItemDetailDialog** (`src/pages/projects/components/ItemDetailDialog.tsx`):
- Added due date picker
- Added estimated time input (hours and minutes)
- Added subtask management UI
- Save functionality for all new fields

### Type Definitions

Added new types in `src/types/projects.ts`:
- `Subtask`: Represents a single subtask
- `ItemWithSubtasks`: Item with parsed subtasks array

## Usage

### Setting a Deadline

1. Click on a card to open the detail dialog
2. Select a date from the "Due Date" field
3. Click "Save"
4. The card will now show the deadline with countdown

### Adding Estimated Time

1. Click on a card to open the detail dialog
2. Enter hours and/or minutes in the "Estimated Time" fields
3. Click "Save"
4. When starting a focus session from this card, the timer will use this duration

### Creating Subtasks

1. Click on a card to open the detail dialog
2. Scroll to the "Subtasks" section
3. Type a subtask title and press Enter or click the + button
4. Click checkboxes to mark subtasks as complete
5. Click "Save" to persist changes

### Viewing Column Metrics

Column metrics are automatically displayed at the top of each column:
- Shows total number of cards
- Shows sum of estimated hours for all cards in the column

## Future Enhancements

Potential improvements for future releases:
- Add recurring deadlines
- Support for subtask dependencies
- Estimated time vs actual time comparison
- Gantt chart view based on deadlines
- Notifications for upcoming deadlines
- Time tracking per subtask
- Export column metrics to reports

## Testing

To test the new features:
1. Create a new card or edit an existing one
2. Add a due date, estimated time, and some subtasks
3. Verify the card displays all information correctly
4. Start a focus session and confirm it uses the estimated time
5. Check that column metrics update when cards are added/modified
6. Move cards between columns and verify metrics recalculate

## Notes

- All new fields are optional - existing cards will continue to work without them
- The subtasks field stores data as JSON in the database
- Times are stored in minutes in the database but displayed in hours/minutes format
- The countdown calculation respects timezone and calculates based on calendar days

